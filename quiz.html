<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°¤é”æ•¸ç† | Yoda's Optical Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* å…‰åŠæ•ˆæœ */
        .glow-red {
            box-shadow: 0 0 10px #ef4444, 0 0 20px #ef4444;
        }
        .glow-blue {
            box-shadow: 0 0 10px #3b82f6, 0 0 20px #3b82f6;
        }
        
        /* è‡ªå®šç¾©é¸å–®æ¨£å¼ */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            appearance: none;
        }

        /* å–®å­—å¡ç¿»è½‰èˆ‡åˆ‡æ›å‹•ç•« */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-toggle.active {
            background-color: #3b82f6; /* Blue 500 */
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 0 10px #3b82f6;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- é ‚éƒ¨å°è¦½ -->
    <header class="w-full max-w-4xl flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">
            ğŸ§ª å°¤é”æ•¸ç†
        </h1>
        <nav class="flex gap-2">
            <button onclick="switchPage('sim')" id="nav-sim" class="px-4 py-2 rounded-lg text-sm font-bold bg-slate-700 hover:bg-slate-600 transition text-green-400">
                å¯¦é©—å®¤
            </button>
            <button onclick="switchPage('practice')" id="nav-practice" class="px-4 py-2 rounded-lg text-sm font-bold bg-slate-800 hover:bg-slate-700 transition text-slate-400">
                ç‰¹è¨“å ´
            </button>
        </nav>
    </header>

    <!-- é é¢ 1: å‹•æ…‹æ¨¡æ“¬å™¨ -->
    <main id="page-sim" class="w-full max-w-4xl flex flex-col gap-4 fade-in">
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 flex flex-col md:flex-row gap-4 items-center justify-between">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <label class="text-slate-400 whitespace-nowrap">å…ƒä»¶ï¼š</label>
                <select id="opticsType" onchange="updateSettings()" class="w-full md:w-64 bg-slate-900 border border-slate-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:border-green-500 transition">
                    <option value="convex_lens">å‡¸é€é¡ (Convex Lens)</option>
                    <option value="concave_lens">å‡¹é€é¡ (Concave Lens)</option>
                    <option value="concave_mirror">å‡¹é¢é¡ (Concave Mirror)</option>
                    <option value="convex_mirror">å‡¸é¢é¡ (Convex Mirror)</option>
                    <option value="plane_mirror">å¹³é¢é¡ (Plane Mirror)</option>
                </select>
            </div>
            <div class="text-sm text-slate-400 flex items-center gap-2">
                <span class="inline-block w-3 h-3 bg-red-500 rounded-full glow-red"></span> ç‰©é«”
                <span class="inline-block w-3 h-3 bg-blue-500 rounded-full glow-blue ml-2"></span> åƒ
            </div>
        </div>

        <!-- ç•«å¸ƒå®¹å™¨ -->
        <div class="relative w-full bg-black rounded-xl overflow-hidden border-2 border-slate-700 shadow-2xl" style="height: 400px;">
            <canvas id="simCanvas" class="w-full h-full cursor-move touch-none"></canvas>
            
            <!-- æç¤ºæ–‡å­— -->
            <div class="absolute bottom-4 left-4 bg-slate-900/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-slate-700 pointer-events-none">
                <div class="text-xs text-slate-400 mb-1">æˆåƒç‹€æ…‹</div>
                <div id="imageStatus" class="text-lg font-bold text-white">---</div>
                <div id="magRate" class="text-sm text-green-400 font-mono mt-1">---</div>
            </div>
            
            <!-- æ‹–æ›³æç¤º -->
            <div id="dragHint" class="absolute top-1/2 left-1/4 transform -translate-x-1/2 -translate-y-1/2 text-white/30 text-4xl animate-pulse pointer-events-none">
                â†” <span class="text-sm block text-center">æ‹–æ›³</span>
            </div>
        </div>

        <div class="flex justify-end">
            <button onclick="switchPage('practice')" class="group flex items-center gap-2 bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-full font-bold transition shadow-lg shadow-green-900/50">
                é€²å…¥ç‰¹è¨“æ¨¡å¼
                <span class="group-hover:translate-x-1 transition-transform">â†’</span>
            </button>
        </div>
    </main>

    <!-- é é¢ 2: å–®å­—å¡ç·´ç¿’ -->
    <main id="page-practice" class="hidden w-full max-w-2xl flex flex-col gap-6 fade-in">
        
        <!-- é€²åº¦æ¢ -->
        <div class="w-full bg-slate-800 rounded-full h-2.5">
            <div id="progressBar" class="bg-green-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>

        <!-- é¡Œç›®å¡ç‰‡ -->
        <div id="quizCard" class="bg-slate-800 border border-slate-700 rounded-2xl p-8 shadow-2xl relative min-h-[400px] flex flex-col">
            
            <!-- é¡Œç›®é¡¯ç¤ºå€ -->
            <div class="text-center mb-8">
                <div class="inline-block px-3 py-1 bg-slate-700 rounded-full text-xs text-slate-300 mb-3">
                    ç¬¬ <span id="qCurrent">1</span> / <span id="qTotal">10</span> é¡Œ
                </div>
                <h2 id="qType" class="text-2xl font-bold text-green-400 mb-2">å‡¸é€é¡</h2>
                <p class="text-lg text-slate-300">ç‰©é«”ä½ç½®ï¼š<span id="qPos" class="text-white font-bold border-b-2 border-green-500 pb-1">å…©å€ç„¦è·å¤–</span></p>
            </div>

            <!-- é¸æ“‡å€ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-grow content-center" id="choicesArea">
                
                <!-- 1. æ­£ç«‹/å€’ç«‹ -->
                <div class="flex flex-col gap-2">
                    <span class="text-xs text-slate-400 uppercase tracking-wider text-center">æ–¹å‘</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('inv', 'æ­£ç«‹')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="inv" data-val="æ­£ç«‹">æ­£ç«‹</button>
                        <button onclick="selectOption('inv', 'å€’ç«‹')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="inv" data-val="å€’ç«‹">å€’ç«‹</button>
                    </div>
                </div>

                <!-- 2. æ”¾å¤§/ç¸®å° -->
                <div class="flex flex-col gap-2">
                    <span class="text-xs text-slate-400 uppercase tracking-wider text-center">å¤§å°</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('size', 'æ”¾å¤§')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="size" data-val="æ”¾å¤§">æ”¾å¤§</button>
                        <button onclick="selectOption('size', 'ç¸®å°')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="size" data-val="ç¸®å°">ç¸®å°</button>
                        <!-- ç‰¹æ®Šæƒ…æ³ï¼šç›¸ç­‰ -->
                        <button onclick="selectOption('size', 'ç›¸ç­‰')" class="btn-toggle w-1/3 hidden py-2 rounded text-sm text-slate-400" data-group="size" data-val="ç›¸ç­‰">ç›¸ç­‰</button>
                    </div>
                </div>

                <!-- 3. è™›/å¯¦ -->
                <div class="flex flex-col gap-2">
                    <span class="text-xs text-slate-400 uppercase tracking-wider text-center">æ€§è³ª</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('real', 'å¯¦åƒ')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="real" data-val="å¯¦åƒ">å¯¦åƒ</button>
                        <button onclick="selectOption('real', 'è™›åƒ')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="real" data-val="è™›åƒ">è™›åƒ</button>
                    </div>
                </div>

                <!-- 4. åŒå´/ç•°å´ -->
                <div class="flex flex-col gap-2">
                    <span class="text-xs text-slate-400 uppercase tracking-wider text-center">ä½ç½®</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('side', 'åŒå´')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="side" data-val="åŒå´">åŒå´</button>
                        <button onclick="selectOption('side', 'ç•°å´')" class="btn-toggle w-1/2 py-2 rounded text-sm text-slate-400 hover:text-white transition" data-group="side" data-val="ç•°å´">ç•°å´</button>
                    </div>
                </div>
            </div>

            <!-- çµæœå›é¥‹å€ (åˆå§‹éš±è—) -->
            <div id="feedbackArea" class="hidden absolute inset-0 bg-slate-800/95 rounded-2xl z-10 flex flex-col items-center justify-center text-center p-6 backdrop-blur-sm">
                <div id="feedbackIcon" class="text-6xl mb-4">ğŸ‰</div>
                <h3 id="feedbackTitle" class="text-2xl font-bold text-white mb-2">ç­”å°äº†ï¼</h3>
                <p id="feedbackText" class="text-slate-300 mb-6">è§£ææ–‡å­—...</p>
                <button onclick="nextQuestion()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-full font-bold shadow-lg transition">ä¸‹ä¸€é¡Œ</button>
            </div>

            <!-- é€å‡ºæŒ‰éˆ• -->
            <div class="mt-8 text-center">
                <button onclick="checkAnswer()" class="w-full md:w-auto bg-green-600 hover:bg-green-500 text-white px-10 py-3 rounded-lg font-bold shadow-lg shadow-green-900/50 transition transform active:scale-95">
                    ç¢ºèªç­”æ¡ˆ
                </button>
            </div>

        </div>
    </main>

    <script>
        // ==========================================
        // å…¨å±€è®Šæ•¸èˆ‡å·¥å…·
        // ==========================================
        let currentPage = 'sim';

        function switchPage(page) {
            currentPage = page;
            document.getElementById('page-sim').classList.add('hidden');
            document.getElementById('page-practice').classList.add('hidden');
            document.getElementById('nav-sim').classList.remove('text-green-400');
            document.getElementById('nav-practice').classList.remove('text-green-400');
            
            if (page === 'sim') {
                document.getElementById('page-sim').classList.remove('hidden');
                document.getElementById('nav-sim').classList.add('text-green-400');
                resizeCanvas(); // ç¢ºä¿ Canvas å¤§å°æ­£ç¢º
            } else {
                document.getElementById('page-practice').classList.remove('hidden');
                document.getElementById('nav-practice').classList.add('text-green-400');
                initPractice(); // åˆå§‹åŒ–ç·´ç¿’
            }
        }

        // ==========================================
        // æ¨¡æ“¬å™¨é‚è¼¯ (Simulator)
        // ==========================================
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, centerX, centerY;

        // ç‰©ç†åƒæ•¸
        let focalLength = 100; 
        let objectX_rel = -150; // ç›¸å°ä¸­å¿ƒçš„Xåº§æ¨™ (è² ç‚ºå·¦)
        let objectH = 60;
        let type = "convex_lens";
        let isDragging = false;

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            width = canvas.width;
            height = canvas.height;
            centerX = width / 2;
            centerY = height / 2;
            draw();
        }
        window.addEventListener('resize', resizeCanvas);

        function updateSettings() {
            type = document.getElementById('opticsType').value;
            if (type === 'convex_lens' || type === 'concave_mirror') {
                focalLength = 100; 
            } else if (type === 'concave_lens' || type === 'convex_mirror') {
                focalLength = -100;
            } else {
                focalLength = Infinity;
            }
            draw();
        }

        function calculateImage() {
            let p = Math.abs(objectX_rel); // ç‰©è·ç¸½æ˜¯æ­£å€¼
            if (p === 0) p = 0.1;
            let q, m;

            if (type === 'plane_mirror') {
                q = -p;
                m = 1;
            } else {
                // 1/p + 1/q = 1/f  => q = (p*f)/(p-f)
                q = (p * focalLength) / (p - focalLength);
                m = -q / p;
            }
            return { q, m, p };
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            
            // å…‰è»¸
            ctx.strokeStyle = '#334155'; // Slate 700
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();

            // ç¹ªè£½é¡å­/é€é¡
            ctx.strokeStyle = '#22d3ee'; // Cyan 400
            ctx.lineWidth = 4;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#22d3ee';
            ctx.beginPath();
            
            if (type.includes('mirror') && type !== 'plane_mirror') {
                // ç•«å½æ›²çš„é¡å­
                let curve = (type === 'concave_mirror') ? -20 : 20;
                ctx.moveTo(centerX, centerY - 100);
                ctx.quadraticCurveTo(centerX + curve, centerY, centerX, centerY + 100);
            } else if (type === 'plane_mirror') {
                ctx.moveTo(centerX, centerY - 100);
                ctx.lineTo(centerX, centerY + 100);
            } else {
                 // ç•«é€é¡å½¢ç‹€ (ç°¡åŒ–ç‚ºæ©¢åœ“æˆ–ç›´ç·šåŠ ç®­é ­ï¼Œé€™è£¡ç”¨ç›´ç·šç¤ºæ„é€é¡ä¸»è»¸)
                ctx.moveTo(centerX, centerY - 100);
                ctx.lineTo(centerX, centerY + 100);
                // åŠ ä¸Šé€é¡ç¬¦è™Ÿ
                if (type === 'convex_lens') { // ç®­é ­å‘å¤–
                    ctx.lineTo(centerX - 10, centerY + 90); ctx.moveTo(centerX, centerY + 100); ctx.lineTo(centerX + 10, centerY + 90);
                    ctx.moveTo(centerX, centerY - 100); ctx.lineTo(centerX - 10, centerY - 90); ctx.moveTo(centerX, centerY - 100); ctx.lineTo(centerX + 10, centerY - 90);
                } else { // ç®­é ­å‘å…§
                    ctx.moveTo(centerX - 10, centerY + 100); ctx.lineTo(centerX, centerY + 90); ctx.lineTo(centerX + 10, centerY + 100);
                    ctx.moveTo(centerX - 10, centerY - 100); ctx.lineTo(centerX, centerY - 90); ctx.lineTo(centerX + 10, centerY - 100);
                }
            }
            ctx.stroke();
            ctx.shadowBlur = 0; // Reset glow

            // ç„¦é»æ¨™è¨˜
            if (type !== 'plane_mirror') {
                ctx.fillStyle = '#fbbf24'; // Amber 400
                ctx.font = '12px sans-serif';
                let fAbs = Math.abs(focalLength);
                
                // ç•« F å’Œ 2F é»
                [fAbs, 2*fAbs].forEach(dist => {
                    [1, -1].forEach(sign => {
                        let x = centerX + dist * sign;
                        ctx.beginPath();
                        ctx.arc(x, centerY, 3, 0, Math.PI*2);
                        ctx.fill();
                    });
                });

                ctx.fillText("F", centerX - fAbs - 5, centerY + 20);
                ctx.fillText("2F", centerX - 2 * fAbs - 10, centerY + 20);
                ctx.fillText("F'", centerX + fAbs - 5, centerY + 20);
            }

            // è¨ˆç®—æˆåƒ
            let { q, m } = calculateImage();
            
            // æ±ºå®šåƒçš„ X åº§æ¨™ (è¦–è¦ºé‚è¼¯æ ¸å¿ƒ)
            // 1. ç‰©é«”ç¸½æ˜¯åœ¨å·¦é‚Š (objectX_rel ç¸½æ˜¯è² çš„)
            let objVisualX = centerX + objectX_rel;
            
            let imgVisualX;
            // é€é¡ï¼šå¯¦åƒ(q>0)åœ¨å°é¢(å³)ï¼Œè™›åƒ(q<0)åœ¨åŒå´(å·¦)
            // é¢é¡ï¼šå¯¦åƒ(q>0)åœ¨åŒå´(å·¦)ï¼Œè™›åƒ(q<0)åœ¨å°é¢(å³)
            
            if (type.includes('lens')) {
                imgVisualX = centerX + q; 
            } else {
                // é¢é¡ q>0 ä»£è¡¨å¯¦åƒ(é¡å‰/å·¦)ï¼Œq<0 ä»£è¡¨è™›åƒ(é¡å¾Œ/å³)
                // åæ¨™ç³»ï¼šå³ç‚ºæ­£ã€‚
                // å¦‚æœ q=100 (å¯¦), æ‡‰è©²åœ¨ centerX - 100
                // å¦‚æœ q=-100 (è™›), æ‡‰è©²åœ¨ centerX - (-100) = centerX + 100
                imgVisualX = centerX - q;
            }

            // ç¹ªè£½ç‰©é«” (ç´…è‰²å…‰åŠ)
            drawLightSaber(objVisualX, centerY, objectH, '#ef4444', 'ç‰©');

            // ç¹ªè£½åƒ (è—è‰²å…‰åŠ)
            let imgH = objectH * m;
            let isVirtual = (q < 0);
            let statusText = "";
            
            // ç‹€æ…‹åˆ¤æ–·
            if (Math.abs(q) > 5000 || isNaN(q)) {
                statusText = "ä¸æˆåƒ (å…‰ç·šå¹³è¡Œ)";
                document.getElementById('imageStatus').className = "text-lg font-bold text-slate-400";
            } else {
                // æ›´æ–° UI æ–‡å­—
                let sizeText = Math.abs(m).toFixed(2) == 1.00 ? "ç›¸ç­‰" : (Math.abs(m) > 1 ? "æ”¾å¤§" : "ç¸®å°");
                let natureText = isVirtual ? "æ­£ç«‹è™›åƒ" : "å€’ç«‹å¯¦åƒ";
                if(type === 'plane_mirror') natureText = "æ­£ç«‹è™›åƒ (å·¦å³ç›¸å)";
                
                statusText = `${natureText} (${sizeText})`;
                let colorClass = isVirtual ? "text-amber-400" : "text-green-400";
                document.getElementById('imageStatus').className = `text-lg font-bold ${colorClass}`;
                
                // ç•«åƒ
                ctx.save();
                if (isVirtual) ctx.globalAlpha = 0.4; // è™›åƒåŠé€æ˜
                drawLightSaber(imgVisualX, centerY, imgH, '#3b82f6', 'åƒ');
                ctx.restore();
            }

            document.getElementById('imageStatus').innerText = statusText;
            document.getElementById('magRate').innerText = (Math.abs(m) || 0).toFixed(2) + "x";
        }

        function drawLightSaber(x, y, h, color, label) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 4;
            ctx.lineCap = "round";
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            
            ctx.beginPath();
            ctx.moveTo(x, y); // åº•éƒ¨
            ctx.lineTo(x, y - h); // é ‚éƒ¨
            ctx.stroke();
            
            // ç®­é ­ (ç°¡åŒ–ç‚ºå…‰æšˆé ‚ç«¯)
            ctx.fillStyle = color;
            ctx.beginPath();
            // å¦‚æœå€’ç«‹ (hç‚ºè² )ï¼Œç®­é ­åœ¨ä¸‹æ–¹
            let tipY = y - h;
            ctx.arc(x, tipY, 3, 0, Math.PI*2);
            ctx.fill();

            ctx.shadowBlur = 0;
            ctx.fillStyle = color;
            ctx.font = "bold 14px sans-serif";
            ctx.fillText(label, x - 6, y + 20);
        }

        // æ‹–æ›³äº‹ä»¶è™•ç†
        function handleStart(x) {
            // æª¢æŸ¥æ˜¯å¦é»æ“Šåˆ°ç‰©é«” (ç¯„åœå¯¬å®¹åº¦ 30px)
            let objVisualX = centerX + objectX_rel;
            if (Math.abs(x - objVisualX) < 40) {
                isDragging = true;
                document.getElementById('dragHint').style.display = 'none';
            }
        }

        function handleMove(x) {
            if (isDragging) {
                // é™åˆ¶åªèƒ½åœ¨å·¦å´
                let newRelX = x - centerX;
                if (newRelX > -10) newRelX = -10;
                objectX_rel = newRelX;
                draw();
            }
        }

        function handleEnd() {
            isDragging = false;
        }

        // Mouse Events
        canvas.addEventListener('mousedown', e => handleStart(e.offsetX));
        canvas.addEventListener('mousemove', e => handleMove(e.offsetX));
        window.addEventListener('mouseup', handleEnd);

        // Touch Events
        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            let rect = canvas.getBoundingClientRect();
            let touchX = e.touches[0].clientX - rect.left;
            handleStart(touchX);
        }, {passive: false});

        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            if (isDragging) {
                let rect = canvas.getBoundingClientRect();
                let touchX = e.touches[0].clientX - rect.left;
                handleMove(touchX);
            }
        }, {passive: false});

        canvas.addEventListener('touchend', handleEnd);

        // åˆå§‹åŒ–
        setTimeout(() => {
            resizeCanvas();
            updateSettings();
        }, 100);


        // ==========================================
        // ç·´ç¿’æ¨¡å¼é‚è¼¯ (Practice Mode)
        // ==========================================
        
        // é¡Œåº«è³‡æ–™
        const questionBank = [
            { type: "å‡¸é€é¡", pos: "å…©å€ç„¦è·å¤– (2Få¤–)",   ans: { inv: "å€’ç«‹", size: "ç¸®å°", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "å‰›å¥½åœ¨ 2F",          ans: { inv: "å€’ç«‹", size: "ç›¸ç­‰", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "F èˆ‡ 2F ä¹‹é–“",       ans: { inv: "å€’ç«‹", size: "æ”¾å¤§", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "ç„¦é»å…§ (<F)",        ans: { inv: "æ­£ç«‹", size: "æ”¾å¤§", real: "è™›åƒ", side: "åŒå´" } },
            
            { type: "å‡¹é€é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç¸®å°", real: "è™›åƒ", side: "åŒå´" } },
            
            { type: "å‡¹é¢é¡", pos: "å…©å€ç„¦è·å¤– (2Få¤–)",   ans: { inv: "å€’ç«‹", size: "ç¸®å°", real: "å¯¦åƒ", side: "åŒå´" } },
            { type: "å‡¹é¢é¡", pos: "ç„¦é»å…§ (<F)",        ans: { inv: "æ­£ç«‹", size: "æ”¾å¤§", real: "è™›åƒ", side: "ç•°å´" } },
            
            { type: "å‡¸é¢é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç¸®å°", real: "è™›åƒ", side: "ç•°å´" } },
            
            { type: "å¹³é¢é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç›¸ç­‰", real: "è™›åƒ", side: "ç•°å´" } }
        ];

        let currentQIndex = 0;
        let currentSelection = { inv: null, size: null, real: null, side: null };
        let shuffledQuestions = [];

        function initPractice() {
            // æ´—ç‰Œé¡Œç›®
            shuffledQuestions = [...questionBank].sort(() => Math.random() - 0.5);
            currentQIndex = 0;
            document.getElementById('qTotal').innerText = shuffledQuestions.length;
            loadQuestion();
        }

        function loadQuestion() {
            let q = shuffledQuestions[currentQIndex];
            document.getElementById('qCurrent').innerText = currentQIndex + 1;
            document.getElementById('qType').innerText = q.type;
            document.getElementById('qPos').innerText = q.pos;
            
            // æ›´æ–°é€²åº¦æ¢
            let pct = (currentQIndex / shuffledQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${pct}%`;

            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            currentSelection = { inv: null, size: null, real: null, side: null };
            document.querySelectorAll('.btn-toggle').forEach(btn => {
                btn.classList.remove('active');
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            });
            
            // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœæœ‰"ç›¸ç­‰"é¸é …ï¼Œæ ¹æ“šé¡Œç›®éš±è—æˆ–é¡¯ç¤º
            // ç°¡å–®èµ·è¦‹ï¼Œæˆ‘å€‘åœ¨ UI è£¡è—äº†ä¸€å€‹"ç›¸ç­‰"ï¼Œåªæœ‰éœ€è¦æ™‚æ‰é¡¯ç¤ºï¼Œæˆ–è€…çµ±ä¸€åªæœ‰å¤§/å°/ç­‰ä¸‰å€‹é¸é …
            // é€™è£¡ç‚ºäº†æµæš¢ï¼Œæˆ‘å€‘æŠŠ"ç›¸ç­‰"é¸é …å‹•æ…‹è™•ç†
            const equalBtn = document.querySelector('button[data-val="ç›¸ç­‰"]');
            const sizeBtns = document.querySelectorAll('button[data-group="size"]:not([data-val="ç›¸ç­‰"])');
            
            if (q.ans.size === 'ç›¸ç­‰') {
                 equalBtn.classList.remove('hidden');
                 sizeBtns.forEach(b => b.classList.add('hidden'));
                 // è‡ªå‹•é¸ç›¸ç­‰ (æˆ–è®“ç”¨æˆ¶é¸) - é€™è£¡ç°¡åŒ–è®“ç”¨æˆ¶å¿…é ˆé¸å°æ‡‰æŒ‰éˆ•
                 // ç‚ºäº†è®“ä»‹é¢çµ±ä¸€ï¼Œæˆ‘å€‘è®“"ç¸®å°/æ”¾å¤§"æŒ‰éˆ•è®Šæˆ"ç›¸ç­‰"
                 sizeBtns[0].innerText = "ç›¸ç­‰";
                 sizeBtns[0].setAttribute('data-val', 'ç›¸ç­‰');
                 sizeBtns[0].classList.remove('hidden');
                 sizeBtns[1].classList.add('hidden');
            } else {
                equalBtn.classList.add('hidden');
                sizeBtns[0].innerText = "æ”¾å¤§";
                sizeBtns[0].setAttribute('data-val', 'æ”¾å¤§');
                sizeBtns[0].classList.remove('hidden');
                sizeBtns[1].innerText = "ç¸®å°";
                sizeBtns[1].setAttribute('data-val', 'ç¸®å°');
                sizeBtns[1].classList.remove('hidden');
            }

            document.getElementById('feedbackArea').classList.add('hidden');
        }

        function selectOption(group, val) {
            // æ›´æ–°è³‡æ–™
            currentSelection[group] = val;
            
            // æ›´æ–° UI (å–®é¸é‚è¼¯)
            document.querySelectorAll(`button[data-group="${group}"]`).forEach(btn => {
                if (btn.dataset.val === val) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function checkAnswer() {
            // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨é¸å®Œ
            if (Object.values(currentSelection).includes(null)) {
                alert("è«‹å…ˆå®Œæˆæ‰€æœ‰é¸é …çš„é¸æ“‡ï¼");
                return;
            }

            let q = shuffledQuestions[currentQIndex];
            let isCorrect = true;
            let wrongParts = [];

            for (let key in q.ans) {
                if (currentSelection[key] !== q.ans[key]) {
                    isCorrect = false;
                    wrongParts.push(key);
                }
            }

            showFeedback(isCorrect, q);
        }

        function showFeedback(isCorrect, q) {
            const fbArea = document.getElementById('feedbackArea');
            const fbIcon = document.getElementById('feedbackIcon');
            const fbTitle = document.getElementById('feedbackTitle');
            const fbText = document.getElementById('feedbackText');

            fbArea.classList.remove('hidden');
            
            if (isCorrect) {
                fbIcon.innerText = "ğŸ‰";
                fbTitle.innerText = "å®Œå…¨æ­£ç¢ºï¼";
                fbTitle.className = "text-2xl font-bold text-green-400 mb-2";
                fbText.innerText = "åŸåŠ›èˆ‡ä½ åŒåœ¨ï¼Œä½ çš„è§€å¿µéå¸¸æ¸…æ™°ã€‚";
            } else {
                fbIcon.innerText = "âš ï¸";
                fbTitle.innerText = "å·®ä¸€é»é»...";
                fbTitle.className = "text-2xl font-bold text-red-400 mb-2";
                fbText.innerHTML = `æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<br>
                <span class="font-bold text-white">${q.ans.inv}ã€${q.ans.size}ã€${q.ans.real}ã€${q.ans.side}</span>`;
            }
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex >= shuffledQuestions.length) {
                // å®Œæˆæ‰€æœ‰é¡Œç›®
                alert("æ­å–œå®Œæˆæ‰€æœ‰ç‰¹è¨“ï¼");
                initPractice(); // é‡æ–°é–‹å§‹
            } else {
                loadQuestion();
            }
        }

    </script>
</body>
</html>