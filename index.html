<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°¤é”å…‰å­¸å¯¦é©—å®¤ | Yoda's Optical Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* å…‰åŠæ•ˆæœ */
        .glow-red {
            box-shadow: 0 0 10px #ef4444, 0 0 20px #ef4444;
        }
        .glow-blue {
            box-shadow: 0 0 10px #3b82f6, 0 0 20px #3b82f6;
        }
        
        /* è‡ªå®šç¾©é¸å–®æ¨£å¼ */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            appearance: none;
        }

        /* å‹•ç•« */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-toggle.active {
            background-color: #3b82f6; /* Blue 500 */
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 0 10px #3b82f6;
        }
        
        /* éŒ¯èª¤æ™‚çš„é–ƒçˆ */
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- é ‚éƒ¨å°è¦½ -->
    <header class="w-full max-w-4xl flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">
            ğŸ§ª å°¤é”å…‰å­¸å¯¦é©—å®¤
        </h1>
        <nav class="flex gap-2">
            <button onclick="switchPage('sim')" id="nav-sim" class="px-4 py-2 rounded-lg text-sm font-bold bg-slate-700 hover:bg-slate-600 transition text-green-400">
                å¯¦é©—å®¤
            </button>
            <button onclick="switchPage('practice')" id="nav-practice" class="px-4 py-2 rounded-lg text-sm font-bold bg-slate-800 hover:bg-slate-700 transition text-slate-400">
                ç‰¹è¨“å ´
            </button>
        </nav>
    </header>

    <!-- ================= é é¢ 1: å‹•æ…‹æ¨¡æ“¬å™¨ ================= -->
    <main id="page-sim" class="w-full max-w-4xl flex flex-col gap-4 fade-in">
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="bg-slate-800 p-4 rounded-xl shadow-lg border border-slate-700 flex flex-col md:flex-row gap-4 items-center justify-between">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <label class="text-slate-400 whitespace-nowrap">å…ƒä»¶ï¼š</label>
                <select id="opticsType" onchange="updateSettings()" class="w-full md:w-64 bg-slate-900 border border-slate-600 text-white rounded-lg px-3 py-2 focus:outline-none focus:border-green-500 transition">
                    <option value="convex_lens">å‡¸é€é¡ (Convex Lens)</option>
                    <option value="concave_lens">å‡¹é€é¡ (Concave Lens)</option>
                    <option value="concave_mirror">å‡¹é¢é¡ (Concave Mirror)</option>
                    <option value="convex_mirror">å‡¸é¢é¡ (Convex Mirror)</option>
                    <option value="plane_mirror">å¹³é¢é¡ (Plane Mirror)</option>
                </select>
            </div>
            <div class="text-sm text-slate-400 flex items-center gap-2">
                <span class="inline-block w-3 h-3 bg-red-500 rounded-full glow-red"></span> ç‰©é«”
                <span class="inline-block w-3 h-3 bg-blue-500 rounded-full glow-blue ml-2"></span> åƒ
            </div>
        </div>

        <!-- ç•«å¸ƒå®¹å™¨ -->
        <div class="relative w-full bg-black rounded-xl overflow-hidden border-2 border-slate-700 shadow-2xl" style="height: 400px;">
            <canvas id="simCanvas" class="w-full h-full cursor-move touch-none"></canvas>
            
            <!-- æç¤ºæ–‡å­— -->
            <div class="absolute bottom-4 left-4 bg-slate-900/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-slate-700 pointer-events-none">
                <div class="text-xs text-slate-400 mb-1">æˆåƒç‹€æ…‹</div>
                <div id="imageStatus" class="text-lg font-bold text-white">---</div>
                <div id="magRate" class="text-sm text-green-400 font-mono mt-1">---</div>
            </div>
            
            <!-- æ‹–æ›³æç¤º -->
            <div id="dragHint" class="absolute top-1/2 left-1/4 transform -translate-x-1/2 -translate-y-1/2 text-white/30 text-4xl animate-pulse pointer-events-none">
                â†” <span class="text-sm block text-center">æ‹–æ›³</span>
            </div>
        </div>

        <div class="flex justify-end">
            <button onclick="switchPage('practice')" class="group flex items-center gap-2 bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-full font-bold transition shadow-lg shadow-green-900/50">
                é€²å…¥ç‰¹è¨“æ¨¡å¼
                <span class="group-hover:translate-x-1 transition-transform">â†’</span>
            </button>
        </div>
    </main>

    <!-- ================= é é¢ 2: å–®å­—å¡ç·´ç¿’ ================= -->
    <main id="page-practice" class="hidden w-full max-w-2xl flex flex-col gap-6 fade-in">
        
        <!-- é€²åº¦æ¢èˆ‡åˆ†æ•¸ -->
        <div class="flex items-center gap-4">
            <div class="flex-grow bg-slate-800 rounded-full h-2.5">
                <div id="progressBar" class="bg-green-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="text-sm text-slate-400 font-mono">Score: <span id="scoreDisplay" class="text-green-400 font-bold">0</span></div>
        </div>

        <!-- é¡Œç›®å¡ç‰‡ -->
        <div id="quizCard" class="bg-slate-800 border border-slate-700 rounded-2xl p-6 md:p-8 shadow-2xl relative min-h-[450px] flex flex-col">
            
            <!-- é¡Œç›®é¡¯ç¤ºå€ -->
            <div class="text-center mb-6">
                <div class="inline-block px-3 py-1 bg-slate-700 rounded-full text-xs text-slate-300 mb-3">
                    ç¬¬ <span id="qCurrent">1</span> / <span id="qTotal">10</span> é¡Œ
                </div>
                <h2 id="qType" class="text-2xl font-bold text-green-400 mb-2">å‡¸é€é¡</h2>
                <p class="text-lg text-slate-300">ç‰©é«”ä½ç½®ï¼š<span id="qPos" class="text-white font-bold border-b-2 border-green-500 pb-1">å…©å€ç„¦è·å¤–</span></p>
            </div>

            <!-- é¸æ“‡å€ (ä¿®æ­£ç‰ˆå¸ƒå±€) -->
            <div class="grid grid-cols-1 gap-5 flex-grow content-start" id="choicesArea">
                
                <!-- 1. æ­£ç«‹/å€’ç«‹ -->
                <div class="flex flex-col gap-1">
                    <span class="text-xs text-slate-500 uppercase tracking-wider text-center font-bold">æ–¹å‘</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('inv', 'æ­£ç«‹')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="inv" data-val="æ­£ç«‹">æ­£ç«‹</button>
                        <button onclick="selectOption('inv', 'å€’ç«‹')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="inv" data-val="å€’ç«‹">å€’ç«‹</button>
                    </div>
                </div>

                <!-- 2. æ”¾å¤§/ç›¸ç­‰/ç¸®å° (ä¿®æ­£ï¼šæ°¸é é¡¯ç¤ºä¸‰å€‹é¸é …) -->
                <div class="flex flex-col gap-1">
                    <span class="text-xs text-slate-500 uppercase tracking-wider text-center font-bold">å¤§å°</span>
                    <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                        <button onclick="selectOption('size', 'æ”¾å¤§')" class="btn-toggle w-1/3 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="size" data-val="æ”¾å¤§">æ”¾å¤§</button>
                        <button onclick="selectOption('size', 'ç›¸ç­‰')" class="btn-toggle w-1/3 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="size" data-val="ç›¸ç­‰">ç›¸ç­‰</button>
                        <button onclick="selectOption('size', 'ç¸®å°')" class="btn-toggle w-1/3 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="size" data-val="ç¸®å°">ç¸®å°</button>
                    </div>
                </div>

                <!-- 3. è™›/å¯¦ èˆ‡ åŒå´/ç•°å´ (åˆä½µåœ¨åŒä¸€è¡Œä»¥ç¯€çœç©ºé–“ï¼Œæˆ–åˆ†é–‹) -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col gap-1">
                        <span class="text-xs text-slate-500 uppercase tracking-wider text-center font-bold">æ€§è³ª</span>
                        <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                            <button onclick="selectOption('real', 'å¯¦åƒ')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="real" data-val="å¯¦åƒ">å¯¦åƒ</button>
                            <button onclick="selectOption('real', 'è™›åƒ')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="real" data-val="è™›åƒ">è™›åƒ</button>
                        </div>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-xs text-slate-500 uppercase tracking-wider text-center font-bold">ä½ç½®</span>
                        <div class="flex rounded-lg bg-slate-900 p-1 border border-slate-700">
                            <button onclick="selectOption('side', 'åŒå´')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="side" data-val="åŒå´">åŒå´</button>
                            <button onclick="selectOption('side', 'ç•°å´')" class="btn-toggle w-1/2 py-3 rounded text-sm text-slate-400 hover:text-white transition font-medium" data-group="side" data-val="ç•°å´">ç•°å´</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµæœå›é¥‹å€ (è¦†è“‹å±¤) -->
            <div id="feedbackArea" class="hidden absolute inset-0 bg-slate-900/95 rounded-2xl z-20 flex flex-col items-center justify-center text-center p-6 backdrop-blur-sm">
                <div id="feedbackIcon" class="text-6xl mb-4 animate-bounce">ğŸ‰</div>
                <h3 id="feedbackTitle" class="text-2xl font-bold text-white mb-2">ç­”å°äº†ï¼</h3>
                <div class="text-left bg-slate-800 p-4 rounded-lg border border-slate-700 mb-6 w-full max-w-xs">
                    <p class="text-xs text-slate-400 mb-1">æ­£ç¢ºè§£ç­”ï¼š</p>
                    <p id="feedbackText" class="text-slate-200 text-sm font-mono leading-relaxed">
                        <!-- å‹•æ…‹å¡«å…¥ -->
                    </p>
                </div>
                <button onclick="nextQuestion()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-full font-bold shadow-lg transition w-full md:w-auto">ä¸‹ä¸€é¡Œ &rarr;</button>
            </div>

            <!-- é€å‡ºæŒ‰éˆ• -->
            <div class="mt-6 text-center">
                <button onclick="checkAnswer()" class="w-full bg-green-600 hover:bg-green-500 text-white px-6 py-4 rounded-xl font-bold shadow-lg shadow-green-900/50 transition transform active:scale-95 text-lg tracking-wide">
                    ç¢ºèªç­”æ¡ˆ
                </button>
            </div>

        </div>
    </main>

    <script>
        // ==========================================
        // 1. æ ¸å¿ƒï¼šé é¢åˆ‡æ›é‚è¼¯
        // ==========================================
        let currentPage = 'sim';

        function switchPage(page) {
            currentPage = page;
            document.getElementById('page-sim').classList.add('hidden');
            document.getElementById('page-practice').classList.add('hidden');
            document.getElementById('nav-sim').classList.remove('text-green-400');
            document.getElementById('nav-practice').classList.remove('text-green-400');
            
            if (page === 'sim') {
                document.getElementById('page-sim').classList.remove('hidden');
                document.getElementById('nav-sim').classList.add('text-green-400');
                setTimeout(resizeCanvas, 50); // ç¢ºä¿åˆ‡æ›å¾Œ Canvas å¤§å°æ­£ç¢º
            } else {
                document.getElementById('page-practice').classList.remove('hidden');
                document.getElementById('nav-practice').classList.add('text-green-400');
                if(shuffledQuestions.length === 0) initPractice(); // åˆæ¬¡é€²å…¥æ‰åˆå§‹åŒ–
            }
        }

        // ==========================================
        // 2. æ¨¡æ“¬å™¨é‚è¼¯ (Physics Engine)
        // ==========================================
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, centerX, centerY;

        let focalLength = 100; 
        let objectX_rel = -150; 
        let objectH = 60;
        let type = "convex_lens";
        let isDragging = false;

        function resizeCanvas() {
            if(canvas.parentElement) {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                width = canvas.width;
                height = canvas.height;
                centerX = width / 2;
                centerY = height / 2;
                draw();
            }
        }
        window.addEventListener('resize', resizeCanvas);

        function updateSettings() {
            type = document.getElementById('opticsType').value;
            // ç„¦è·è¨­å®š (ç¬¦åˆç‰©ç†ç¬¦è™Ÿæ…£ä¾‹)
            if (type === 'convex_lens' || type === 'concave_mirror') {
                focalLength = 100; // åŒ¯èšå‹
            } else if (type === 'concave_lens' || type === 'convex_mirror') {
                focalLength = -100; // ç™¼æ•£å‹
            } else {
                focalLength = Infinity; // å¹³é¢é¡
            }
            draw();
        }

        function calculateImage() {
            let p = Math.abs(objectX_rel); // ç‰©è·
            if (p === 0) p = 0.1;
            let q, m;

            if (type === 'plane_mirror') {
                q = -p; // å¹³é¢é¡: åƒè· = -ç‰©è·
                m = 1;
            } else {
                // é€ é¡è€…å…¬å¼: 1/p + 1/q = 1/f
                q = (p * focalLength) / (p - focalLength);
                m = -q / p;
            }
            return { q, m, p };
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            
            // ç•«å…‰è»¸
            ctx.strokeStyle = '#334155'; 
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();

            // ç•«å…ƒä»¶ (é¡å­/é€é¡)
            ctx.strokeStyle = '#22d3ee';
            ctx.lineWidth = 4;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#22d3ee';
            ctx.beginPath();
            
            if (type.includes('mirror') && type !== 'plane_mirror') {
                let curve = (type === 'concave_mirror') ? -20 : 20;
                ctx.moveTo(centerX, centerY - 100);
                ctx.quadraticCurveTo(centerX + curve, centerY, centerX, centerY + 100);
            } else if (type === 'plane_mirror') {
                ctx.moveTo(centerX, centerY - 100);
                ctx.lineTo(centerX, centerY + 100);
            } else {
                ctx.moveTo(centerX, centerY - 100);
                ctx.lineTo(centerX, centerY + 100);
                // ç°¡å–®é€é¡ç¬¦è™Ÿ
                if (type === 'convex_lens') {
                    ctx.moveTo(centerX - 10, centerY - 90); ctx.lineTo(centerX, centerY - 100); ctx.lineTo(centerX + 10, centerY - 90);
                    ctx.moveTo(centerX - 10, centerY + 90); ctx.lineTo(centerX, centerY + 100); ctx.lineTo(centerX + 10, centerY + 90);
                } else {
                    ctx.moveTo(centerX - 10, centerY - 100); ctx.lineTo(centerX, centerY - 90); ctx.lineTo(centerX + 10, centerY - 100);
                    ctx.moveTo(centerX - 10, centerY + 100); ctx.lineTo(centerX, centerY + 90); ctx.lineTo(centerX + 10, centerY + 100);
                }
            }
            ctx.stroke();
            ctx.shadowBlur = 0; 

            // ç•«ç„¦é» F (å¹³é¢é¡é™¤å¤–)
            if (type !== 'plane_mirror') {
                ctx.fillStyle = '#fbbf24'; 
                ctx.font = '12px sans-serif';
                let fAbs = Math.abs(focalLength);
                
                [fAbs, 2*fAbs].forEach(dist => {
                    [1, -1].forEach(sign => {
                        let x = centerX + dist * sign;
                        ctx.beginPath();
                        ctx.arc(x, centerY, 3, 0, Math.PI*2);
                        ctx.fill();
                    });
                });
                ctx.fillText("F", centerX - fAbs - 5, centerY + 20);
                ctx.fillText("2F", centerX - 2 * fAbs - 10, centerY + 20);
            }

            // è¨ˆç®—èˆ‡ç¹ªåœ–
            let { q, m } = calculateImage();
            
            let objVisualX = centerX + objectX_rel;
            let imgVisualX;
            
            // === è¦–è¦ºé‚è¼¯æ ¸å¿ƒ ===
            // é€é¡ï¼šå¯¦åƒ(q>0)åœ¨å³(ç•°å´)ï¼Œè™›åƒ(q<0)åœ¨å·¦(åŒå´)
            // é¢é¡ï¼šå¯¦åƒ(q>0)åœ¨å·¦(åŒå´)ï¼Œè™›åƒ(q<0)åœ¨å³(ç•°å´/é¡å¾Œ)
            if (type.includes('lens')) {
                imgVisualX = centerX + q; 
            } else {
                imgVisualX = centerX - q;
            }

            // ç•«ç‰©
            drawLightSaber(objVisualX, centerY, objectH, '#ef4444', 'ç‰©');

            // ç•«åƒ
            let imgH = objectH * m;
            let isVirtual = (q < 0);
            let statusText = "";
            
            if (Math.abs(q) > 5000 || isNaN(q)) {
                statusText = "ä¸æˆåƒ (å…‰ç·šå¹³è¡Œ)";
                document.getElementById('imageStatus').className = "text-lg font-bold text-slate-400";
            } else {
                let sizeText = Math.abs(m).toFixed(2) == 1.00 ? "ç›¸ç­‰" : (Math.abs(m) > 1 ? "æ”¾å¤§" : "ç¸®å°");
                let natureText = isVirtual ? "æ­£ç«‹è™›åƒ" : "å€’ç«‹å¯¦åƒ";
                if(type === 'plane_mirror') natureText = "æ­£ç«‹è™›åƒ";
                
                statusText = `${natureText} (${sizeText})`;
                let colorClass = isVirtual ? "text-amber-400" : "text-green-400";
                document.getElementById('imageStatus').className = `text-lg font-bold ${colorClass}`;
                
                ctx.save();
                if (isVirtual) ctx.globalAlpha = 0.4;
                drawLightSaber(imgVisualX, centerY, imgH, '#3b82f6', 'åƒ');
                ctx.restore();
            }

            document.getElementById('imageStatus').innerText = statusText;
            document.getElementById('magRate').innerText = (Math.abs(m) || 0).toFixed(2) + "x";
        }

        function drawLightSaber(x, y, h, color, label) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 4;
            ctx.lineCap = "round";
            ctx.shadowBlur = 15;
            ctx.shadowColor = color;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y - h);
            ctx.stroke();
            
            ctx.fillStyle = color;
            ctx.beginPath();
            let tipY = y - h;
            ctx.arc(x, tipY, 3, 0, Math.PI*2);
            ctx.fill();

            ctx.shadowBlur = 0;
            ctx.fillStyle = color;
            ctx.font = "bold 14px sans-serif";
            ctx.fillText(label, x - 6, y + 20);
        }

        // æ‹–æ›³äº‹ä»¶
        function handleStart(x) {
            let objVisualX = centerX + objectX_rel;
            if (Math.abs(x - objVisualX) < 40) {
                isDragging = true;
                document.getElementById('dragHint').style.display = 'none';
            }
        }
        function handleMove(x) {
            if (isDragging) {
                let newRelX = x - centerX;
                if (newRelX > -10) newRelX = -10; // é™åˆ¶åœ¨å·¦å´
                objectX_rel = newRelX;
                draw();
            }
        }
        function handleEnd() { isDragging = false; }

        canvas.addEventListener('mousedown', e => handleStart(e.offsetX));
        canvas.addEventListener('mousemove', e => handleMove(e.offsetX));
        window.addEventListener('mouseup', handleEnd);
        canvas.addEventListener('touchstart', e => { e.preventDefault(); handleStart(e.touches[0].clientX - canvas.getBoundingClientRect().left); }, {passive:false});
        canvas.addEventListener('touchmove', e => { e.preventDefault(); if(isDragging) handleMove(e.touches[0].clientX - canvas.getBoundingClientRect().left); }, {passive:false});
        canvas.addEventListener('touchend', handleEnd);

        setTimeout(() => { resizeCanvas(); updateSettings(); }, 100);


        // ==========================================
        // 3. ç·´ç¿’æ¨¡å¼é‚è¼¯ (Drill Mode) - å·²ä¿®æ­£é‚è¼¯
        // ==========================================
        
        // å®Œæ•´é¡Œåº« (Convex Lens, Concave Lens, Concave Mirror, Convex Mirror, Plane Mirror)
        // é—œéµé‚è¼¯å®šç¾©ï¼š
        // å¯¦åƒï¼šé€é¡åœ¨ç•°å´ï¼Œé¢é¡åœ¨åŒå´
        // è™›åƒï¼šé€é¡åœ¨åŒå´ï¼Œé¢é¡åœ¨ç•°å´(é¡å¾Œ)
        const questionBank = [
            // å‡¸é€é¡
            { type: "å‡¸é€é¡", pos: "å…©å€ç„¦è·å¤– (2Få¤–)",   ans: { inv: "å€’ç«‹", size: "ç¸®å°", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "å‰›å¥½åœ¨ 2F",          ans: { inv: "å€’ç«‹", size: "ç›¸ç­‰", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "F èˆ‡ 2F ä¹‹é–“",       ans: { inv: "å€’ç«‹", size: "æ”¾å¤§", real: "å¯¦åƒ", side: "ç•°å´" } },
            { type: "å‡¸é€é¡", pos: "ç„¦é»å…§ (<F)",        ans: { inv: "æ­£ç«‹", size: "æ”¾å¤§", real: "è™›åƒ", side: "åŒå´" } },
            
            // å‡¹é€é¡ (åªæœ‰ä¸€ç¨®çµæœ)
            { type: "å‡¹é€é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç¸®å°", real: "è™›åƒ", side: "åŒå´" } },
            
            // å‡¹é¢é¡ (è£œå®Œæ‰€æœ‰æƒ…æ³)
            { type: "å‡¹é¢é¡", pos: "å…©å€ç„¦è·å¤– (2Få¤–)",   ans: { inv: "å€’ç«‹", size: "ç¸®å°", real: "å¯¦åƒ", side: "åŒå´" } },
            { type: "å‡¹é¢é¡", pos: "å‰›å¥½åœ¨ 2F",          ans: { inv: "å€’ç«‹", size: "ç›¸ç­‰", real: "å¯¦åƒ", side: "åŒå´" } }, // æ–°å¢
            { type: "å‡¹é¢é¡", pos: "F èˆ‡ 2F ä¹‹é–“",       ans: { inv: "å€’ç«‹", size: "æ”¾å¤§", real: "å¯¦åƒ", side: "åŒå´" } }, // æ–°å¢
            { type: "å‡¹é¢é¡", pos: "ç„¦é»å…§ (<F)",        ans: { inv: "æ­£ç«‹", size: "æ”¾å¤§", real: "è™›åƒ", side: "ç•°å´" } }, // æ³¨æ„ï¼šé¢é¡è™›åƒåœ¨é¡å¾Œ(ç•°å´)
            
            // å‡¸é¢é¡ (åªæœ‰ä¸€ç¨®çµæœ)
            { type: "å‡¸é¢é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç¸®å°", real: "è™›åƒ", side: "ç•°å´" } }, // æ³¨æ„ï¼šé¢é¡è™›åƒåœ¨é¡å¾Œ
            
            // å¹³é¢é¡
            { type: "å¹³é¢é¡", pos: "ä»»æ„ä½ç½®",           ans: { inv: "æ­£ç«‹", size: "ç›¸ç­‰", real: "è™›åƒ", side: "ç•°å´" } }  // é¡å¾Œ
        ];

        let currentQIndex = 0;
        let score = 0;
        let currentSelection = { inv: null, size: null, real: null, side: null };
        let shuffledQuestions = [];

        function initPractice() {
            // éš¨æ©Ÿæ’åº
            shuffledQuestions = [...questionBank].sort(() => Math.random() - 0.5);
            currentQIndex = 0;
            score = 0;
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('qTotal').innerText = shuffledQuestions.length;
            loadQuestion();
        }

        function loadQuestion() {
            let q = shuffledQuestions[currentQIndex];
            document.getElementById('qCurrent').innerText = currentQIndex + 1;
            document.getElementById('qType').innerText = q.type;
            document.getElementById('qPos').innerText = q.pos;
            
            let pct = (currentQIndex / shuffledQuestions.length) * 100;
            document.getElementById('progressBar').style.width = `${pct}%`;

            // é‡ç½®æ‰€æœ‰æŒ‰éˆ•
            currentSelection = { inv: null, size: null, real: null, side: null };
            document.querySelectorAll('.btn-toggle').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('feedbackArea').classList.add('hidden');
        }

        function selectOption(group, val) {
            currentSelection[group] = val;
            document.querySelectorAll(`button[data-group="${group}"]`).forEach(btn => {
                if (btn.dataset.val === val) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function checkAnswer() {
            // é©—è­‰æ˜¯å¦å¡«å®Œ
            if (Object.values(currentSelection).includes(null)) {
                // ç°¡å–®çš„æ–å‹•å‹•ç•«æç¤º
                document.getElementById('choicesArea').classList.add('shake');
                setTimeout(() => document.getElementById('choicesArea').classList.remove('shake'), 500);
                return;
            }

            let q = shuffledQuestions[currentQIndex];
            let isCorrect = true;

            for (let key in q.ans) {
                if (currentSelection[key] !== q.ans[key]) {
                    isCorrect = false;
                }
            }

            showFeedback(isCorrect, q);
        }

        function showFeedback(isCorrect, q) {
            const fbArea = document.getElementById('feedbackArea');
            const fbIcon = document.getElementById('feedbackIcon');
            const fbTitle = document.getElementById('feedbackTitle');
            const fbText = document.getElementById('feedbackText');

            fbArea.classList.remove('hidden');
            
            if (isCorrect) {
                score += 100;
                document.getElementById('scoreDisplay').innerText = score;
                fbIcon.innerText = "ğŸ‰";
                fbTitle.innerText = "å®Œå…¨æ­£ç¢ºï¼";
                fbTitle.className = "text-2xl font-bold text-green-400 mb-2";
                
                // ç°¡å–®çš„é¼“å‹µèª
                let compliments = ["åŸåŠ›èˆ‡ä½ åŒåœ¨ã€‚", "ä½ çš„è§€å¿µç„¡æ‡ˆå¯æ“Šï¼", "å®Œç¾çš„åˆ¤æ–·ã€‚", "å…‰å­¸å¤§å¸«æ˜¯ä½ ï¼Ÿ"];
                fbText.innerHTML = compliments[Math.floor(Math.random() * compliments.length)];
                
            } else {
                fbIcon.innerText = "âš ï¸";
                fbTitle.innerText = "å·®ä¸€é»é»...";
                fbTitle.className = "text-2xl font-bold text-red-400 mb-2";
                
                // å»ºæ§‹è©³ç´°è§£ç­” HTML
                fbText.innerHTML = `
                    <div class="flex justify-between border-b border-slate-600 py-1"><span>æ–¹å‘</span> <span class="text-white">${q.ans.inv}</span></div>
                    <div class="flex justify-between border-b border-slate-600 py-1"><span>å¤§å°</span> <span class="text-white">${q.ans.size}</span></div>
                    <div class="flex justify-between border-b border-slate-600 py-1"><span>è™›å¯¦</span> <span class="text-white">${q.ans.real}</span></div>
                    <div class="flex justify-between py-1"><span>ä½ç½®</span> <span class="text-white">${q.ans.side}</span></div>
                `;
            }
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex >= shuffledQuestions.length) {
                alert(`ç‰¹è¨“çµæŸï¼ç¸½åˆ†ï¼š${score}`);
                initPractice(); 
            } else {
                loadQuestion();
            }
        }
    </script>
</body>
</html>